{% extends "core/base.html" %}
{% block title %}All Posts & Comments{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4">All Blog Posts (with Comments)</h1>

    {% for post in posts %}
    <div class="card mb-4">
        <div class="card-body">
            <h3>
                <a href="{% url 'post_detail' post.slug %}">{{ post.title }}</a>
            </h3>
            <p class="text-muted">{{ post.created_on|date:"F j, Y" }}</p>

            <hr>
            <h5>Comments:</h5>

            {% for c in post.comments.all|dictsortreversed:"created_at" %}
                <div class="border p-2 mb-2 rounded">
                    <strong>
                        {% if c.author %}
                            {{ c.author.username }}
                        {% else %}
                            {{ c.name }}
                        {% endif %}
                    </strong>

                    {% if not c.approved %}
                        <span class="badge bg-warning text-dark">Pending</span>
                    {% endif %}

                    <br>
                    <small class="text-muted">{{ c.created_at|date:"M j, Y H:i" }}</small>

                    <p class="mt-2">{{ c.content }}</p>

                    <a href="{% url 'post_detail' post.slug %}#comment-{{ c.id }}">View in Post</a>
                </div>
            {% empty %}
                <p class="text-muted">No comments yet.</p>
            {% endfor %}
        </div>
    </div>
    {% empty %}
        <p>No posts available.</p>
    {% endfor %}
</div>
{% endblock %}

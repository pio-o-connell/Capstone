{% extends "core/base.html" %}
{% load static %}
{% load booking_filters %}

{% block title %}Services | Beautiful Outdoor Spaces{% endblock %}

{% block content %}

<section id="services" class="container section my-5">

    <div class="row">
        <div class="col-12 text-center">
            <h1 class="display-6">Services</h1>
            <p class="lead text-muted">Professional outdoor maintenance services</p>
        </div>

        {% for service in services %}
        <article class="col-12 col-md-6 col-xl-3">
            <div class="card h-100">
                {% if service.image %}
                    <img src="{{ service.image.url }}"
                         class="card-img-top"
                         alt="{{ service.name }}">
                {% else %}
                    <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" 
                         style="height: 250px;">
                        <span class="text-white">No Image Available</span>
                    </div>
                {% endif %}
                
                <div class="card-body">
                    <h3 class="card-title sub-heading-color">{{ service.name }}</h3>
                    <p class="card-text small text-muted">{{ service.description }}</p>
                    
                    <!-- Pricing -->
                    <div class="pricing-info my-3">
                        <p class="mb-2"><strong>Pricing:</strong></p>
                        <ul class="list-unstyled">
                            <li>Small: <strong>€{{ service.small_price }}</strong></li>
                            <li>Medium: <strong>€{{ service.medium_price }}</strong></li>
                            <li>Large: <strong>€{{ service.large_price }}</strong></li>
                        </ul>
                    </div>

                    <!-- Size Selection -->
                    <div class="form-group">
                        <label for="size_{{ service.id }}" class="form-label">Select Size:</label>
                        <select name="size" id="size_{{ service.id }}" class="form-select form-select-sm">
                            <option value="small">Small</option>
                            <option value="medium">Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>

                    <!-- Quantity Selection -->
                    <div class="form-group">
                        <label for="quantity_{{ service.id }}" class="form-label">Quantity:</label>
                        <input type="number" id="quantity_{{ service.id }}" 
                               name="quantity" value="1" min="1" max="10" 
                               class="form-control form-control-sm">
                    </div>
                </div>

                <div class="card-footer bg-white border-top">
                    <button class="btn btn-primary btn-sm w-100 add-to-cart-btn" 
                            data-service-id="{{ service.id }}">
                        Add to Cart
                    </button>
                </div>
            </div>
        </article>
        {% empty %}
        <div class="col-12 text-center mt-5">
            <p class="text-muted">No services available at the moment.</p>
        </div>
        {% endfor %}

    </div>

</section>

<script>
document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const serviceId = this.dataset.serviceId;
        const sizeSelect = document.getElementById(`size_${serviceId}`);
        const quantityInput = document.getElementById(`quantity_${serviceId}`);
        
        const size = sizeSelect.value;
        const quantity = quantityInput.value;

        try {
            const response = await fetch('{% url "add_to_cart_ajax" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: JSON.stringify({
                    service_id: serviceId,
                    size: size,
                    quantity: quantity
                })
            });

            const data = await response.json();
            
            if (data.success) {
                alert(`✓ Added to cart!\n${data.message}`);
                quantityInput.value = 1;
            } else {
                alert(`✗ Error: ${data.error}`);
            }
        } catch (error) {
            alert('Error adding to cart. Please try again.');
            console.error('Error:', error);
        }
    });
});
</script>

{% endblock %}

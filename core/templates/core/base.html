<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Meta tags for SEO -->
    <meta name="description"
        content="Love Gardens. Gardening enthusiasts, lawns, proper planting, drainage, Scarifying Aerating lawns">
    <meta name="keywords"
        content="Flowers and shrubs in season, Power washing & moss removal, drains and shoots, Hedges and trees maintenance, Vegetable area - potatoes, Fruit trees and bushes, Sustainable patch for bees, Fallow area, Compost heaps, Mulch area">

    <!-- Title block -->
    <title>{% block title %}Beautiful outdoor spaces{% endblock %}</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'core/images/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'core/images/favicon_io/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'core/images/favicon/favicon-16x16.png' %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="{% static 'core/css/style.css' %}">

    <style>
     /* Ensure anchor target for messages is visible below a fixed header.
         Uses the header-offset CSS variable (header-height) set by header-offset.js. */
    #messages {
        scroll-margin-top: calc(var(--header-height, 0px) + 0.5rem);
    }

    /* Custom in-page modal styles matching site theme */
    .site-modal{display:none;position:fixed;inset:0;z-index:1200;align-items:center;justify-content:center}
    .site-modal.open{display:flex}
    .site-modal-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.45)}
    .site-modal-dialog{position:relative;background:#fff;border-radius:.5rem;max-width:560px;width:94%;box-shadow:0 0.5rem 1rem rgba(0,0,0,.28);overflow:hidden}
    .site-modal-header{padding:.75rem 1rem; background: var(--secondary-color); color: #ffffff}
    .site-modal-header .site-modal-close{color:#fff}
    .site-modal-footer .btn-danger, #siteDeleteConfirm{background:var(--secondary-color);border-color:var(--secondary-color);color:#fff}
    .site-modal-footer .btn-danger:hover, #siteDeleteConfirm:hover{opacity:0.92}
    .site-modal-body{padding:1rem}
    .site-modal-footer{padding:.75rem 1rem;border-top:1px solid rgba(0,0,0,.05)}
    .site-modal-close{background:transparent;border:0}
    </style>

    {% block extra_head %}{% endblock %}
</head>

<body>

    <!-- Header -->
    {% include 'core/includes/header.html' %}


    

    <!-- Main content -->
    <main>
        <!-- Django messages -->
        {% if messages %}
        <div id="messages" class="container mt-3">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <script>
        // Fallback close handler for dismissible alerts: removes the alert when the close button is clicked.
        // This ensures the close button works even if Bootstrap's JS hasn't initialized alerts.
        (function(){
            document.addEventListener('click', function(e){
                var target = e.target;
                if(!target) return;
                if(target.classList && target.classList.contains('btn-close')){
                    var alert = target.closest && target.closest('.alert');
                    if(alert){
                        // begin fade out by removing 'show'
                        alert.classList.remove('show');
                        // wait briefly for CSS transition then remove from DOM
                        setTimeout(function(){ if(alert.parentNode) alert.parentNode.removeChild(alert); }, 150);
                    }
                }
            });
        })();
        </script>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'core/includes/footer.html' %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/aa9af45995.js" crossorigin="anonymous"></script>

    <!-- Header offset script: updates the header height CSS variable to prevent content hiding under the fixed header -->
    <script src="{% static 'core/js/header-offset.js' %}"></script>

    <!-- Site session ID for anonymous users (stored in localStorage).
         - Creates `localStorage.site_session` as JSON: {id, created_at}
         - Only created when there is no session present AND the user is anonymous.
         - Exposes `window.siteSession` and `window.siteSessionId` for other scripts (booking forms).
    -->
    <script>
    (function(){
        var storageKey = 'site_session';
        function makeId(){
            try{ if(window.crypto && crypto.randomUUID) return crypto.randomUUID(); }catch(e){}
            return 's-' + Math.random().toString(36).slice(2,12);
        }
        function nowISO(){ return new Date().toISOString(); }

        var isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};

        var sess = null;
        try{ sess = JSON.parse(localStorage.getItem(storageKey) || 'null'); }catch(e){ sess = null; }

        // Ensure a persistent site_session exists for anonymous visitors only.
        // Create one if missing and the user is not authenticated.
        if(!sess && !isAuthenticated){
            sess = { id: makeId(), created_at: nowISO() };
            try{ localStorage.setItem(storageKey, JSON.stringify(sess)); }catch(e){}
        }

        // Expose to other scripts. If no session (e.g. logged-in user), these will be null.
        window.siteSession = sess;
        window.siteSessionId = sess ? sess.id : null;
        window.getSiteSession = function(){ return window.siteSession || null; };
    })();
    </script>

    {% block extra_js %}{% endblock %}

<!-- Custom site-styled delete modal (in-page) + hidden generic delete form -->
<div id="siteDeleteModal" class="site-modal" aria-hidden="true">
    <div class="site-modal-overlay"></div>
    <div class="site-modal-dialog">
        <div class="site-modal-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0 site-modal-title">Delete comment?</h5>
            <button type="button" class="site-modal-close btn btn-sm btn-close btn-close-white" aria-label="Close"></button>
        </div>
        <div class="site-modal-body">
            <p class="site-modal-body-text">Are you sure you want to delete this comment? This action cannot be undone.</p>
        </div>
        <div class="site-modal-footer text-end">
            <button type="button" class="btn btn-secondary site-modal-cancel">Close</button>
            <button id="siteDeleteConfirm" type="button" class="btn btn-danger">Delete</button>
        </div>
    </div>
</div>

<form id="delete-form-generic" method="post" style="display:none;">
        {% csrf_token %}
</form>

<script>
// Site custom delete modal handling: open on .btn-delete click, submit hidden form on confirm.
document.addEventListener('DOMContentLoaded', function(){
    var activeDeleteUrl = null;
    var activeActionCallback = null; // optional callback for confirm
    var siteModal = document.getElementById('siteDeleteModal');
    var siteTitleEl = siteModal && siteModal.querySelector('.site-modal-title');
    var siteBodyEl = siteModal && siteModal.querySelector('.site-modal-body-text');
    var siteConfirm = document.getElementById('siteDeleteConfirm');
    var siteCancelBtns = document.querySelectorAll('.site-modal-cancel, .site-modal-close');

    function showSiteModal(){
        if(!siteModal) return;
        siteModal.classList.add('open');
        siteModal.setAttribute('aria-hidden','false');
    }
    function hideSiteModal(){
        if(!siteModal) return;
        siteModal.classList.remove('open');
        siteModal.setAttribute('aria-hidden','true');
    }

    // Generic API: showSiteActionModal({title, body, confirmText, onConfirm})
    window.showSiteActionModal = function(opts){
        opts = opts || {};
        if(siteTitleEl) siteTitleEl.textContent = opts.title || 'Confirm action';
        if(siteBodyEl) siteBodyEl.innerHTML = opts.body || '';
        if(siteConfirm) siteConfirm.textContent = opts.confirmText || 'Confirm';
        activeActionCallback = typeof opts.onConfirm === 'function' ? opts.onConfirm : null;
        // if opts.deleteUrl provided, set activeDeleteUrl so default behavior can submit form
        activeDeleteUrl = opts.deleteUrl || null;
        showSiteModal();
    };

    document.addEventListener('click', function(e){
        var btn = e.target.closest && e.target.closest('.btn-delete');
        if(!btn) return;
        activeDeleteUrl = btn.getAttribute('data-delete-url') || null;
        activeActionCallback = null;
        // default delete modal content
        if(siteTitleEl) siteTitleEl.textContent = 'Delete comment?';
        if(siteBodyEl) siteBodyEl.textContent = 'Are you sure you want to delete this comment? This action cannot be undone.';
        if(siteConfirm) siteConfirm.textContent = 'Delete';
        showSiteModal();
    });

    if(siteConfirm){
        siteConfirm.addEventListener('click', function(){
            // If a custom callback is set, call it. Otherwise, if a delete URL is set,
            // submit the generic delete form to that URL.
            if(activeActionCallback){
                try{ activeActionCallback(); }catch(e){}
                hideSiteModal();
                activeActionCallback = null;
                activeDeleteUrl = null;
                return;
            }
            if(!activeDeleteUrl){ hideSiteModal(); return; }
            var form = document.getElementById('delete-form-generic');
            form.action = activeDeleteUrl;
            form.submit();
        });
    }

    siteCancelBtns.forEach(function(btn){ btn.addEventListener('click', function(){ hideSiteModal(); activeActionCallback = null; activeDeleteUrl = null; }); });
    var overlay = siteModal && siteModal.querySelector('.site-modal-overlay');
    if(overlay){ overlay.addEventListener('click', function(){ hideSiteModal(); activeActionCallback = null; activeDeleteUrl = null; }); }
});
</script>

</body>
</html>